#!/bin/bash


### EDit these variables BEFORE running

### Global analysis parameters ###
export OUTPUT_PATH=/project/def-ilafores/analysis/20220316_humann_pipeline_dev/test_make_custom_buglist_input
export SLURM_ALLOCATION="def-ilafores"
# FLAG that tells soft to copy NT_DB and PROT_DB locally on compute node
# MP2: Set to 0. Copying DB doesnt accelerate analysis
export SLURM_DB_COPY_LOCALSCRATCH=0
# set email to receive job completion/fail notification
export SLURM_JOB_EMAIL="ronj2303@usherbrooke.ca"


### preprocess parameters ###
#sample file: 3 columns
#sample_name\t/path/to/fastq1\t/path/to/fastq2
# NO HEADERS!!!
export PREPROCESS_OUTPUT_NAME="preprocess"
export PREPROCESS_SAMPLES_LIST_TSV="${OUTPUT_PATH}/raw.sample.test.tsv"
export PREPROCESS_KNEADDATA_DB="/nfs3_ib/ip29-ib/ssdpool/shared/ilafores_group/host_genomes/GRCh38_index/grch38_1kgmaj"
#export PREPROCESS_KNEADDATA_SEQUENCER="TruSeq3"
export PREPROCESS_KNEADDATA_TRIMMOMATIC="ILLUMINACLIP:/cvmfs/soft.mugqic/CentOS6/software/trimmomatic/Trimmomatic-0.39/adapters/TruSeq3-PE-2.fa:2:30:10 SLIDINGWINDOW:4:30 MINLEN:100"
export PREPROCESS_KNEADDATA_BOWTIE2_OPTIONS="--very-sensitive-local"
export PREPROCESS_SLURM_WALLTIME="24:00:00"
export PREPROCESS_SLURM_NBR_THREADS="24"
export PREPROCESS_SLURM_MEMORY="30G"



### taxonomic profile sample parameters ###
#sample file: 3 columns
#sample_name\t/path/to/fastq1\t/path/to/fastq2
# NO HEADERS!!!
# Autogenerated by preprocess script or you can define your own if no precprocessing required
# Autogenerated tsv should be in ${OUTPUT_PATH}/preprocess/taxonomic_profile.sample.tsv
export TAXONOMIC_SAMPLE_OUTPUT_NAME="taxonomic_profile"
export TAXONOMIC_SAMPLE_SAMPLES_LIST_TSV="${OUTPUT_PATH}/${PREPROCESS_OUTPUT_NAME}/taxonomic_profile.sample.tsv"
export TAXONOMIC_SAMPLE_LEVEL=(
    "D:domains"
    "P:phylums"
    "C:classes"
    "O:orders"
    "F:families"
    "G:genuses"
    "S:species"
)
export TAXONOMIC_SAMPLE_KRAKEN2_DB_PATH="/nfs3_ib/ip29-ib/ssdpool/shared/ilafores_group/kraken2_dbs/k2_pluspfp_16gb_20210517"
export TAXONOMIC_SAMPLE_BRACKEN_READ_LEN="150"
export TAXONOMIC_SAMPLE_SLURM_WALLTIME="6:00:00"
export TAXONOMIC_SAMPLE_SLURM_NBR_THREADS="24"
export TAXONOMIC_SAMPLE_SLURM_MEMORY="125G"



### taxonomic profile ALL samples parameters ###
#sample file: 3 columns
#sample_name\t/path/to/fastq1\t/path/to/fastq2
# NO HEADERS!!!
# reports are generated using taxonomic_profile.sample.sh script. Default path $OUTPUT_PATH/*/*_bracken/*_bracken_S.kreport
# You can define your own custom path if reports were not generated in predefined path
export TAXONOMIC_ALL_OUTPUT_NAME="taxonomic_profile_all"
export TAXONOMIC_ALL_BRACKEN_KREPORTS="$OUTPUT_PATH/${TAXONOMIC_SAMPLE_OUTPUT_NAME}/*/*_bracken/*_bracken_S.kreport"
export TAXONOMIC_ALL_LEVEL=(
    "D:domains"
    "P:phylums"
    "C:classes"
    "O:orders"
    "F:families"
    "G:genuses"
    "S:species"
)
export TAXONOMIC_ALL_NT_DBNAME="boreal_moss"
export TAXONOMIC_ALL_CHOCOPHLAN_DB="/nfs3_ib/ip29-ib/ssdpool/shared/ilafores_group/humann_dbs/chocophlan"
export TAXONOMIC_ALL_SLURM_WALLTIME="24:00:00"
export TAXONOMIC_ALL_SLURM_NBR_THREADS="48"
export TAXONOMIC_ALL_SLURM_MEMORY="251G"


### functionnal profiling run parameters
#sample file: 2 columns
#sample_name\t/path/to/fastq
# NO HEADERS!!!
# Autogenerated by preprocess script or you can define your own if no precprocessing required
# Autogenerated tsv should be in ${OUTPUT_PATH}/preprocess/functionnal_profile.sample.tsv
export FUNCPROFILING_OUTPUT_NAME="functionnal_profile"
export FUNCPROFILING_SAMPLES_LIST_TSV="${OUTPUT_PATH}/${PREPROCESS_OUTPUT_NAME}/functionnal_profile.sample.tsv"
# issue #24: Possible search mode = DUAL, NT, PROT
export FUNCPROFILING_SEARCH_MODE="DUAL"
export FUNCPROFILING_NT_DB="$OUTPUT_PATH/${TAXONOMIC_ALL_OUTPUT_NAME}/${TAXONOMIC_ALL_NT_DBNAME}"
export FUNCPROFILING_PROT_DB="/project/def-ilafores/common/humann3/lib/python3.7/site-packages/humann/data/uniref"
export FUNCPROFILING_SLURM_BASE_WALLTIME="24:00:00"
export FUNCPROFILING_SLURM_BASE_NBR_THREADS="24"
export FUNCPROFILING_SLURM_BASE_MEMORY="30G"
export FUNCPROFILING_SLURM_FAT_WALLTIME="24:00:00"
export FUNCPROFILING_SLURM_FAT_NBR_THREADS="24"
export FUNCPROFILING_SLURM_FAT_MEMORY="125G"



### taxonomic profile sample parameters ###
#sample file: 3 columns
#sample_name\t/path/to/fastq1\t/path/to/fastq2
# NO HEADERS!!!
# Autogenerated by preprocess script or you can define your own if no precprocessing required
# Autogenerated tsv should be in ${OUTPUT_PATH}/preprocess/taxonomic_profile.sample.tsv
# export ASSEMBLY_SAMPLE_F1_PATH_REGEX=$OUTPUT_PATH/preprocess/*/*_paired_sorted_1.fastq
# export ASSEMBLY_SAMPLE_F2_PATH_REGEX=$OUTPUT_PATH/preprocess/*/*_paired_sorted_2.fastq
export ASSEMBLY_OUTPUT_NAME="denovo_assembly"
export ASSEMBLY_SAMPLE_LIST_TSV="${OUTPUT_PATH}/${PREPROCESS_OUTPUT_NAME}/taxonomic_profile.sample.tsv"
export ASSEMBLY_BIN_REFINEMENT_MIN_COMPLETION=50
export ASSEMBLY_BIN_REFINEMENT_MAX_CONTAMINATION=10
export ASSEMBLY_SLURM_WALLTIME="24:00:00"
export ASSEMBLY_SLURM_NBR_THREADS="48"
export ASSEMBLY_SLURM_MEMORY="251G"


### bin annotation sample parameters ###
export ANNOTATE_OUTPUT_NAME="classify_annotate_bins"
export ANNOTATE_SLURM_NBR_THREADS="24"
export ANNOTATE_PPLACER_NBR_THREADS="2" ## requires 45G of ram for each thread used
export ANNOTATE_SLURM_MEMORY="125G"
export ANNOTATE_SLURM_WALLTIME="24:00:00"

### quantify bin parameters ###
# export QUANTIFY_SAMPLE_PATH_REGEX=$OUTPUT_PATH/*/${PREPROCESS_OUTPUT_NAME}/*_paired_sorted_*.fastq
# export QUANTIFY_SLURM_NBR_THREADS="24"
# export QUANTIFY_SLURM_MEMORY="30G"
# export QUANTIFY_SLURM_WALLTIME="24:00:00"
