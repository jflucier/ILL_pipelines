#!/bin/bash


### EDit these variables BEFORE running

### Global analysis parameters ###
export OUPUT_PATH=/project/def-ilafores/analysis/20220316_humann_pipeline_dev/test_make_custom_buglist_input
export SLURM_ALLOCATION="def-ilafores"
# FLAG that tells soft to copy NT_DB and PROT_DB locally on compute node
# MP2: Set to 0. Copying DB doesnt accelerate analysis
export SLURM_DB_COPY_LOCALSCRATCH=0



### preprocess parameters ###
#sample file: 3 columns
#sample_name\t/path/to/fastq1\t/path/to/fastq2
# NO HEADERS!!!
export PREPROCESS_SAMPLES_LIST_TSV="${OUPUT_PATH}/raw.sample.test.tsv"
export PREPROCESS_KNEADDATA_DB="/nfs3_ib/ip29-ib/ssdpool/shared/ilafores_group/host_genomes/GRCh38_index/grch38_1kgmaj"
export PREPROCESS_KNEADDATA_SEQUENCER="TruSeq3"
export PREPROCESS_KNEADDATA_TRIMMOMATIC="SLIDINGWINDOW:4:30 MINLEN:50"
export PREPROCESS_KNEADDATA_BOWTIE2_OPTIONS="--very-sensitive"
export PREPROCESS_SLURM_WALLTIME="24:00:00"
export PREPROCESS_SLURM_NBR_THREADS="24"
export PREPROCESS_SLURM_MEMORY="30G"



### taxonomic profile sample parameters ###
#sample file: 3 columns
#sample_name\t/path/to/fastq1\t/path/to/fastq2
# NO HEADERS!!!
# Autogenerated by preprocess script or you can define your own if no precprocessing required
# Autogenerated tsv should be in ${OUPUT_PATH}/preprocess/taxonomic_profile.sample.tsv
export TAXONOMIC_SAMPLE_SAMPLES_LIST_TSV="${OUPUT_PATH}/preprocess/taxonomic_profile.sample.tsv"
export TAXONOMIC_SAMPLE_LEVEL=(
    "D:domains"
    "P:phylums"
    "C:classes"
    "O:orders"
    "F:families"
    "G:genuses"
    "S:species"
)
export TAXONOMIC_SAMPLE_KRAKEN2_DB_PATH="/nfs3_ib/ip29-ib/ssdpool/shared/ilafores_group/kraken2_dbs/k2_pluspfp_16gb_20210517"
export TAXONOMIC_SAMPLE_BRACKEN_READ_LEN="150"
export TAXONOMIC_SAMPLE_SLURM_WALLTIME="6:00:00"
export TAXONOMIC_SAMPLE_SLURM_NBR_THREADS="24"
export TAXONOMIC_SAMPLE_SLURM_MEMORY="125G"



### taxonomic profile ALL samples parameters ###
#sample file: 3 columns
#sample_name\t/path/to/fastq1\t/path/to/fastq2
# NO HEADERS!!!
# reports are generated using taxonomic_profile.sample.sh script. Default path $OUPUT_PATH/*/*_bracken/*_bracken_S.kreport
# You can define your own custom path if reports were not generated in predefined path
export TAXONOMIC_ALL_BRACKEN_KREPORTS="$OUPUT_PATH/taxonomic_profile/*/*_bracken/*_bracken_S.kreport"
export TAXONOMIC_ALL_LEVEL=(
    "D:domains"
    "P:phylums"
    "C:classes"
    "O:orders"
    "F:families"
    "G:genuses"
    "S:species"
)
export TAXONOMIC_ALL_NT_DBNAME="boreal_moss"
export TAXONOMIC_ALL_CHOCOPHLAN_DB="/nfs3_ib/ip29-ib/ssdpool/shared/ilafores_group/humann_dbs/chocophlan"
export TAXONOMIC_ALL_SLURM_WALLTIME="24:00:00"
export TAXONOMIC_ALL_SLURM_NBR_THREADS="48"
export TAXONOMIC_ALL_SLURM_MEMORY="251G"


### functionnal profiling run parameters
#sample file: 2 columns
#sample_name\t/path/to/fastq
# NO HEADERS!!!
# Autogenerated by preprocess script or you can define your own if no precprocessing required
# Autogenerated tsv should be in ${OUPUT_PATH}/preprocess/functionnal_profile.sample.tsv
export FUNCPROFILING_SAMPLES_LIST_TSV="${OUPUT_PATH}/preprocess/functionnal_profile.sample.tsv"
export FUNCPROFILING_NT_DB="$OUPUT_PATH/taxonomic_profile_all/${TAXONOMIC_ALL_NT_DBNAME}-bugs_list"
export FUNCPROFILING_PROT_DB="/project/def-ilafores/common/humann3/lib/python3.7/site-packages/humann/data/uniref"
export FUNCPROFILING_SLURM_WALLTIME="24:00:00"
export FUNCPROFILING_SLURM_NBR_THREADS="24"
export FUNCPROFILING_SLURM_MEMORY="30G"



### taxonomic profile sample parameters ###
#sample file: 3 columns
#sample_name\t/path/to/fastq1\t/path/to/fastq2
# NO HEADERS!!!
# Autogenerated by preprocess script or you can define your own if no precprocessing required
# Autogenerated tsv should be in ${OUPUT_PATH}/preprocess/taxonomic_profile.sample.tsv
export ASSEMBLY_SAMPLE_F1_PATH_REGEX=$OUPUT_PATH/preprocess/*/*_paired_sorted_1.fastq
export ASSEMBLY_SAMPLE_F2_PATH_REGEX=$OUPUT_PATH/preprocess/*/*_paired_sorted_2.fastq
# export ASSEMBLY_SAMPLE_LIST_TSV="${OUPUT_PATH}/preprocess/taxonomic_profile.sample.tsv"
export ASSEMBLY_BIN_REFINEMENT_MIN_COMPLETION=50
export ASSEMBLY_BIN_REFINEMENT_MAX_CONTAMINATION=10
export ASSEMBLY_SLURM_WALLTIME="24:00:00"
export ASSEMBLY_SLURM_NBR_THREADS="48"
export ASSEMBLY_SLURM_MEMORY="251G"


### bin annotation sample parameters ###
export ANNOTATE_SLURM_NBR_THREADS="24"
export ANNOTATE_PPLACER_NBR_THREADS="2" ## requires 45G of ram for each thread used
export ANNOTATE_SLURM_MEMORY="125G"
export ANNOTATE_SLURM_WALLTIME="24:00:00"

### quantofy bin parameters ###
export QUANTIFY_SAMPLE_PATH_REGEX=$OUPUT_PATH/*/preprocess/*_paired_sorted_*.fastq
export QUANTIFY_SLURM_NBR_THREADS="24"
export QUANTIFY_SLURM_MEMORY="30G"
export QUANTIFY_SLURM_WALLTIME="24:00:00"
