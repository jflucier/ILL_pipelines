# build new image using this command: singularity build --force --fakeroot concoct.1.1.0.sif concoct.1.1.0.def

BootStrap: docker
From: ubuntu:20.04

%setup

%environment
    #export LD_LIBRARY_PATH=/APBS-3.0.0.Linux/lib:${LD_LIBRARY_PATH}
    # export DEBIAN_FRONTEND=noninteractive
    # export TZ=America/New_York
%post
    apt-get -y update
    apt-get install -y wget python3 python3-pip python3-setuptools


    pip install --upgrade pip
    export DEBIAN_FRONTEND=noninteractive
    # export TZ=America/New_York
    # echo "######### $TZ ###############"
    echo "######### $DEBIAN_FRONTEND ###############"
    ln -fs /usr/share/zoneinfo/America/New_York /etc/localtime
    apt-get install -y tzdata
    #dpkg-reconfigure --frontend noninteractive tzdata

    apt-get install -qq build-essential libgsl-dev bedtools mummer samtools

    cd /opt
    wget https://github.com/BinPro/CONCOCT/archive/refs/tags/1.1.0.tar.gz
    tar -xvzf 1.1.0.tar.gz
    cd CONCOCT-1.1.0

    pip install -r requirements.txt
    pip install numpy==1.18.5 python-dateutil==2.8.1

    wget https://github.com/BinPro/integration_test_data/archive/v1.0.tar.gz
    mkdir tests/test_data/integration_test_data
    tar -xvzf v1.0.tar.gz -C tests/test_data/integration_test_data --strip-components=1

    python3 setup.py install
