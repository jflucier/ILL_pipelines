# build new image using this command:
# singularity build --force --fakeroot metawrap.1.3.test.sif metawrap.1.3.test.def

BootStrap: localimage
From: metawrap.1.3.sif

# BootStrap: docker
# From: ubuntu:20.04

%setup
    # needed to copy compilation result from ip29 back to container image. Compiling inside image doesnt work
    #cp -r /home/jflucier/app/taxator-tk-1.5.0 ${SINGULARITY_ROOTFS}/

%files
    # needed to copy compilation result from ip29 back to container image. Compiling inside image doesnt work
    #/home/jflucier/app/taxator-tk-1.5.0 /

%environment
    # export PATH=/taxator-tk-1.5.0/core/bin:$PATH
    # export GTDBTK_DATA_PATH=/GTDB
    # export PATH=/miniconda3/envs/roary-env/bin/:$PATH
%post
    # apt-get -y install joblib
    echo ". /miniconda3/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
    echo "conda activate metawrap-env" >> $SINGULARITY_ENVIRONMENT
    # conda init bash
    # . /miniconda3/etc/profile.d/conda.sh
    # conda activate metawrap-env
    #
    # mamba install -y quast==5.2.0

    # apt-get update && apt-get -y upgrade
    #
    # ln -fs /usr/share/zoneinfo/America/New_York /etc/localtime
    #
    # perl -MCPAN -e 'upgrade'
    #
    # apt-get -y install \
    # build-essential \
    # wget \
    # bzip2 \
    # ca-certificates \
    # libglib2.0-0 \
    # libxext6 \
    # libsm6 \
    # libxrender1 \
    # git \
    # tzdata \
    # openjdk-17-jre \
    # roary

    # perl -MCPAN -e 'upgrade'

    # sed -i 's/import cgi/import html/g' /miniconda3/envs/metawrap-env/opt/quast-5.0.2/quast_libs/site_packages/jsontemplate/jsontemplate.py
    # sed -i 's/cgi.escape/html.escape/g' /miniconda3/envs/metawrap-env/opt/quast-5.0.2/quast_libs/site_packages/jsontemplate/jsontemplate.py

    # conda init bash
    # . /miniconda3/etc/profile.d/conda.sh
    # conda activate metawrap-env
    # mamba install -y -c bioconda quast==5.2.0

    # pip3 install joblib

    # apt-get -y install roary
    #conda install joblib
