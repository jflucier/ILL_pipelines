# build new image using this command:
# singularity build --force --fakeroot gtdbtk.sif gtdbtk.def

BootStrap: docker
From: ubuntu:22.04

%setup

%environment
#  export PATH=/mash-Linux64-v2.3:$PATH
#  export PATH=/FastTree_2.1.11:$PATH
#  export PATH=/pplacer-Linux-v1.1.alpha19:$PATH
#  export PATH=/fastANI-Linux64-v1.33:$PATH
#  export PATH=/hmmer-3.3.2/bin:$PATH

%post
  apt-get update && apt-get -y upgrade

  ln -fs /usr/share/zoneinfo/America/New_York /etc/localtime

  # # needed for concoct
  export DEBIAN_FRONTEND=noninteractive
  apt-get -y install \
  build-essential \
  wget \
  git \
  less \
  zlib1g \
  unzip \
  hmmer \
  prodigal \
  fastani \
  pplacer \
  fasttree \
  mash \
  python3 python3-dev python3-pip python3-venv

  rm -rf /var/lib/apt/lists/*
  apt-get clean

#  apt-get install -y \
#  python3 \
#  python3-pip \
#  python3-venv

  pip3 install gtdbtk==2.2.1

#  cd /
#  wget https://github.com/marbl/Mash/releases/download/v2.3/mash-Linux64-v2.3.tar
#  tar -xvf mash-Linux64-v2.3.tar

#  mkdir /FastTree_2.1.11
#  cd /FastTree_2.1.11
#  wget http://www.microbesonline.org/fasttree/FastTree

#  cd /
#  wget https://github.com/matsen/pplacer/releases/download/v1.1.alpha19/pplacer-linux-v1.1.alpha19.zip
#  unzip pplacer-linux-v1.1.alpha19.zip

#  mkdir /fastANI-Linux64-v1.33
#  cd /fastANI-Linux64-v1.33
#  wget https://github.com/ParBLiSS/FastANI/releases/download/v1.33/fastANI-Linux64-v1.33.zip
#  unzip fastANI-Linux64-v1.33.zip

#  mkdir /Prodigal_v2.6.3
#  cd /Prodigal_v2.6.3
#  wget https://github.com/hyattpd/Prodigal/releases/download/v2.6.3/prodigal.linux
#  ln -s prodigal.linux prodigal
#  chmod a+x prodigal*

#  cd /
#  wget http://eddylab.org/software/hmmer/hmmer-3.3.2.tar.gz
#  tar -xvzf hmmer-3.3.2.tar.gz
#  cd hmmer-3.3.2
#  ./configure
#  make
#  make install



#  #Installing Anaconda 3 https://repo.anaconda.com/miniconda/Miniconda3-py39_4.11.0-Linux-x86_64.sh
#  cd /
#  wget -c https://repo.anaconda.com/miniconda/Miniconda3-py39_4.11.0-Linux-x86_64.sh
#  /bin/bash Miniconda3-py39_4.11.0-Linux-x86_64.sh -bfp /miniconda3
#  export PATH=/miniconda3/bin:$PATH
#
#  conda config --file /miniconda3/.condarc --add channels defaults
#  conda config --file /miniconda3/.condarc --add channels conda-forge
#  conda config --file /miniconda3/.condarc --add channels bioconda
#  conda config --file /miniconda3/.condarc --add channels cruizperez
#
#  echo ". /miniconda3/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
#  echo "conda activate microbeannotator" >> $SINGULARITY_ENVIRONMENT
#
#  . /miniconda3/etc/profile.d/conda.sh
#  conda create -n microbeannotator python=3.7 pip microbeannotator=2.0.5
#  conda activate microbeannotator
#  pip3 install hmmer==0.1.0
#  pip3 install wget
#  pip3 install biopython
#
#  conda deactivate